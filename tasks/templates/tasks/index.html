<!DOCTYPE html>
<html>
	<head>
		{% load static %}
		{% include 'bases/head_base.html' %}

		<title>Tasks</title>
	
		<link rel="stylesheet" type="text/css" href="{% static 'css/base.css' %}" />
		<link rel="stylesheet" type="text/css" href="{% static 'tasks/css/style.css' %}" />

		

	</head>
	<body>
		<div class="nav">
			<ul>
				<li id="logo" class="nav-hover"><a href="/"><b>Collabo<span class="crimson">Dev</span></b></a></li>
				<li><a href="/tasks/" class="active">Tasks</a></li>
				<li><a href="/users/">Users</a></li>
				<li id="user-widget"><a href="/profile/"><span id="user-widget-text">{{ user.get_username }}</span></a></li>
			</ul>
		</div>
		<div class="progress-bar-div"><div class="progress-bar" style="width:0;"></div></div>
		<script src="{% static 'tasks/js/xp_bar.js' %}" tasks-completed="{{ tasks_completed }}"></script>

		<div id="page-description">
			{% if error_message %}
				<p>{{ error_message }}</p>
			{% else %}
				<p>On this page you can see a list of all open and closed tasks. You are also able to claim any open and unclaimed tasks for yourself.</p>
			{% endif %}
		</div>

		{% if tasks %}
			<div style="position: relative">
				<h2>Open Tasks</h2>
				<div class="new-task-div">
					<button class="new-task" onclick="show_modal('create_task', '{{ csrf_token }}')">New Task</button>
				</div>
			</div>
			<table class="task-table">
				<tr>
					<th class="task-table-name">Name</th>
					<th class="task-table-priority">Priority</th>
					<th class="task-table-deadline">Deadline</th>
					<th class="task-table-size">Size</th>
					<th class="task-table-age">Age</th>
					<th class="claim-info"></th>
				</tr>
				{% for task in tasks %}
				{% if task.task_open %}
				<tr id="{{ task.id }}">
					<td class="task-table-name" onclick = "show_modal('task_data', '{{ task.id }}')">{{ task.task_name }}</td>
					<td style="display: none">{{ task.task_description }}</td>
					<td style="display: none">{{ task.task_owner }}</td>
					<td class="task-table-priority" onclick = "show_modal('task_data', '{{ task.id }}')">{{ task.task_priority }}</td>
					<td class="task-table-deadline" onclick = "show_modal('task_data', '{{ task.id }}')">{{ task.deadline_date }}</td>
					<td class="task-table-size" onclick = "show_modal('task_data', '{{ task.id }}')">{{ task.task_size }}</td>
					<td class="task-table-age" onclick = "show_modal('task_data', '{{ task.id }}')"></td>
					<td style="display: none">{{ task.task_open }}</td>

					<td class="claim-info">
						<form action="/tasks/claim/" method="post">
							{% csrf_token %}
							<input type="hidden" value="{{ task.id }}" name="task_id">
							<input type="submit" value="Claim" class="claim" />
						</form>
						<form action="/tasks/close/" method="post" style="display: none">
							{% csrf_token %}
							<input type="hidden" value="{{ task.id }}" name="task_id">
							<input type="button" value="Complete" class="close-task" onclick="show_modal('confirmation', ['{{ task.id }}', '1', 'Are you sure you want to close this task?'])"/>
						</form>
						<form action="/tasks/unclaim/" method="post" style="display: none">
							{% csrf_token %}
							<input type="hidden" value="{{ task.id }}" name="task_id">
							<input type="button" value="Unclaim" class="unclaim" onclick="show_modal('confirmation', ['{{ task.id }}', '2', 'Are you sure you want to unclaim this task?'])"/>
						</form>
					</td>
					<script src="{% static 'tasks/js/size_int_to_str.js' %}"></script>
					<script src="{% static 'tasks/js/create_buttons.js' %}" task-owner="{{ task.task_owner }}"></script>
					<script src="{% static 'tasks/js/date_to_age.js' %}" task-publish-date="{{ task.publish_date.isoformat }}"></script>
				</tr>
				{% endif %}
				{% endfor %}
			</table>
			<div class="horizontal-break"></div>
			<h2>Closed Tasks</h2>
			<table class="task-table">
				<tr>
					<th class="task-table-name">Name</th>
					<th class="task-table-priority">Priority</th>
					<th class="task-table-deadline">Deadline</th>
					<th class="task-table-size">Size</th>
					<th class="task-table-age">Age</th>
				</tr>
				{% for task in tasks %}
				{% if not task.task_open %}
				<tr id="{{ task.id }}">
					<td class="task-table-name" onclick = "show_modal('task_data', '{{ task.id }}')">{{ task.task_name }}</td>
					<td style="display: none">{{ task.task_description }}</td>
					<td style="display: none">{{ task.task_owner }}</td>
					<td class="task-table-priority" onclick = "show_modal('task_data', '{{ task.id }}')">{{ task.task_priority }}</td>
					<td class="task-table-deadline" onclick = "show_modal('task_data', '{{ task.id }}')">{{ task.deadline_date }}</td>
					<td class="task-table-size"  onclick = "show_modal('task_data', '{{ task.id }}')">{{ task.task_size }}</td>
					<td class="task-table-age" onclick = "show_modal('task_data', '{{ task.id }}')"></td>
					<td style="display: none">{{ task.task_open }}</td>

					<script src="{% static 'tasks/js/size_int_to_str.js' %}"></script>
					<script src="{% static 'tasks/js/date_to_age.js' %}" task-publish-date="{{ task.publish_date.isoformat }}"></script>
				</tr>
				{% endif %}
				{% endfor %}
			</table>
		{% else %}
			<p>No tasks have been created. Create one <a href="/tasks/create">here</a></p>
		{% endif %}
	<div class="modal-box">
		<div class="modal-content">
			<span class="modal-close-button" onclick="modal.style.display = 'none'">&times;</span>
			<div class="modal-text">
			</div>
		</div>
	</div>
	<script src="{% static 'tasks/js/modal.js' %}">

	</script>
	<div class="horizontal-break"></div>
	{% include 'bases/footer_base.html' %}
	</body>
</html>
