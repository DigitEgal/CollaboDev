<!DOCTYPE html>
<html>
	<head>
		{% load static %}
		{% include 'bases/head_base.html' %}

		<title>{{ chosen_user.username }} {% if chosen_user.first_name %}({{ chosen_user.first_name }} {{ chosen_user.last_name }}){% endif %}</title>
	
		<link rel="stylesheet" type="text/css" href="{% static 'accounts/profile/css/style.css' %}" />
	</head>
	<body>
		{% include 'bases/navbar_base.html' %}
		<script>
		if("{{ user.username }}" == "{{ chosen_user.username }}") {
			document.getElementsByClassName('nav')[0].children[0].children[5].children[0].className = 'active';
		}
		</script>

		<div class="parallax" style="background-image: url('{% static chosen_user.profile.associated_background %}')"></div>
		<div id="header-div">
			<img id="profile-picture" src="{% static chosen_user.profile.associated_image %}" />
			<h1>{{ chosen_user.first_name }} {{ chosen_user.last_name }} / {{ chosen_user.username }}{% if chosen_user.is_superuser %} <span class="tooltip">&#9733;<span class="tooltiptext">This user has administrative privileges</span></span>{% endif %}</h1>
			<script>
			var profilePicture = document.getElementById('profile-picture')

			var userStatusRequest = new XMLHttpRequest()
			userStatusRequest.open("POST", "/accounts/user_status/")
			userStatusRequest.setRequestHeader("X-CSRFToken", "{{ csrf_token }}")
			userStatusRequest.onreadystatechange = function() {
				if (userStatusRequest.readyState === 4 && userStatusRequest.status === 200) {
					var responseData = JSON.parse(userStatusRequest.responseText)
					var userStatus = responseData["status"]

					if (userStatus === false) {
						profilePicture.removeAttribute("style")
					}
					else {
						profilePicture.style.borderColor = "#01FF70"
					}
				}
			}
			userStatusRequest.send("R@{{ chosen_user.id }}")
			setInterval(function() {
				let userStatusRequest = new XMLHttpRequest()
				userStatusRequest.open("POST", "/accounts/user_status/")
				userStatusRequest.setRequestHeader("X-CSRFToken", "{{ csrf_token }}")
				userStatusRequest.onreadystatechange = function() {
					if (userStatusRequest.readyState === 4 && userStatusRequest.status === 200) {
						var responseData = JSON.parse(userStatusRequest.responseText)
						var userStatus = responseData["status"]
	
						if (userStatus === false) {
							profilePicture.removeAttribute("style")
						}
						else {
							profilePicture.style.borderColor = "#01FF70"
						}
					}
				}
				userStatusRequest.send("R@{{ chosen_user.id }}")
			}, 60000)
			</script>
		</div>
		<div class="content">
			<h2>Biography</h2>
			<p>
				{% if chosen_user.profile.biography %}
					{{ chosen_user.profile.biography }}
				{% else %}
					{{ chosen_user.first_name }} has not written a biography
				{% endif %}
			</p>			
			<p><u><a href="{{ chosen_user.profile.url }}" target="_blank">{{ chosen_user.profile.url }}</a></u></p>
			<h2>Contact</h2>
			<p>
				{% if chosen_user.email %}
					<a href="mailto:{{ chosen_user.email }}">{{ chosen_user.email }}</a>
				{% else %}
					{{ chosen_user.first_name }} has not provided an email
				{% endif %}
			</p>
			<p><i>Date joined: {{ chosen_user.date_joined }}</i></p>
		</div>
		{% include 'bases/footer_base.html' %}
	</body>
</html>
